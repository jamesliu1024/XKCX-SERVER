<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="seig.ljm.xkckserver.mapper.PredictionMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="seig.ljm.xkckserver.entity.Prediction">
        <id column="prediction_id" property="predictionId" />
        <result column="predict_date" property="predictDate" />
        <result column="predicted_count" property="predictedCount" />
        <result column="generate_time" property="generateTime" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        prediction_id, predict_date, predicted_count, generate_time
    </sql>

    <!-- 获取指定日期范围内的预测数据统计 -->
    <select id="selectPredictionStats" resultType="java.util.Map">
        SELECT 
            MAX(predicted_count) as max_count,
            MIN(predicted_count) as min_count,
            AVG(predicted_count) as avg_count,
            COUNT(*) as total_records
        FROM Prediction
        WHERE predict_date BETWEEN #{startDate} AND #{endDate}
    </select>

    <!-- 获取最近的预测数据 -->
    <select id="selectLatestPredictions" resultMap="BaseResultMap">
        SELECT 
            <include refid="Base_Column_List" />
        FROM Prediction
        WHERE predict_date >= #{currentDate}
        ORDER BY predict_date
        LIMIT #{limit}
    </select>

</mapper>
