<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="seig.ljm.xkckserver.mapper.OperationLogMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="seig.ljm.xkckserver.entity.OperationLog">
        <id column="log_id" property="logId" />
        <result column="operator_id" property="operatorId" />
        <result column="operation_type" property="operationType" />
        <result column="target_id" property="targetId" />
        <result column="operation_time" property="operationTime" />
        <result column="details" property="details" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        log_id, operator_id, operation_type, target_id, operation_time, details
    </sql>

    <!-- 获取指定操作员的操作记录 -->
    <select id="getByOperator" resultMap="BaseResultMap">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM operation_log
        WHERE operator_id = #{operatorId}
        <if test="startTime != null and endTime != null">
            AND operation_time BETWEEN #{startTime} AND #{endTime}
        </if>
        ORDER BY operation_time DESC
    </select>

    <!-- 按操作类型查询日志 -->
    <select id="getByOperationType" resultMap="BaseResultMap">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM operation_log
        WHERE operation_type = #{operationType}
        <if test="startTime != null and endTime != null">
            AND operation_time BETWEEN #{startTime} AND #{endTime}
        </if>
        ORDER BY operation_time DESC
    </select>

</mapper>
